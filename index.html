<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z_CHAT | Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø©</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <style>
        :root { --primary: #0f0; --bg: #0a0a0a; --glass: rgba(25, 25, 25, 0.96); }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', Tahoma, sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        #login-screen { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .login-card { background: #151515; padding: 30px; border-radius: 20px; border: 1px solid #333; width: 320px; text-align: center; }
        input { width: 90%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #333; color: var(--primary); border-radius: 10px; outline: none; }
        
        /* Ø§Ù„Ù‡ÙŠØ¯Ø± */
        header { padding: 12px 20px; background: var(--glass); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #222; }
        .room-tag { background: #1a1a1a; padding: 5px 12px; border-radius: 20px; border: 1px solid var(--primary); color: var(--primary); }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        #chat-container { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; background: #0a0a0a; }
        .msg { padding: 10px 16px; border-radius: 18px; max-width: 75%; font-size: 14px; position: relative; }
        .sent { align-self: flex-start; background: var(--primary); color: #000; }
        .received { align-self: flex-end; background: #222; color: #fff; }

        /* Ø²Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ù‚Ø¯Ù… */
        #load-more-btn { align-self: center; background: #1a1a1a; color: var(--primary); border: 1px solid var(--primary); padding: 8px 15px; border-radius: 20px; cursor: pointer; margin-bottom: 10px; font-size: 12px; }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        .input-area { padding: 15px; background: #151515; display: flex; gap: 8px; border-top: 1px solid #222; position: relative; }
        #msgInput { flex: 1; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 25px; outline: none; }
        .action-btn { background: var(--primary); border: none; padding: 10px 15px; border-radius: 50%; cursor: pointer; font-weight: bold; }
        
        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ */
        .emoji-picker { position: absolute; bottom: 70px; right: 20px; background: #151515; border: 1px solid #333; border-radius: 15px; padding: 10px; display: none; grid-template-columns: repeat(6, 1fr); gap: 5px; max-height: 200px; overflow-y: auto; z-index: 6000; }
        .emoji-item { cursor: pointer; font-size: 20px; padding: 5px; }
        .emoji-item:hover { background: #333; border-radius: 5px; }

        .side-panel { position: fixed; right: -320px; top: 0; width: 300px; height: 100%; background: var(--glass); transition: 0.4s; z-index: 4000; border-left: 1px solid #333; }
        .side-panel.active { right: 0; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-card">
        <h2 style="color:var(--primary);">Z_CHAT</h2>
        <input type="text" id="userNameInput" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø±">
        <input type="text" id="roomCodeInput" placeholder="ÙƒÙˆØ¯ Ø§Ù„ØºØ±ÙØ©">
        <button onclick="startApp()" style="width:100%; padding:12px; background:var(--primary); border-radius:10px; cursor:pointer;">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<header>
    <div class="room-tag" id="room-display">Ø§Ù„ØºØ±ÙØ©: --</div>
    <div style="display:flex; gap:10px;">
        <div onclick="toggleNotifications()" style="cursor:pointer;">ğŸ””<span id="notif-count" style="color:red; font-size:12px;"></span></div>
        <div onclick="togglePanel()" style="cursor:pointer;">ğŸ‘¥</div>
    </div>
</header>

<div id="chat-container">
    <button id="load-more-btn" onclick="loadMoreMessages()">Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ø£Ù‚Ø¯Ù…</button>
</div>

<div class="input-area">
    <button class="action-btn" onclick="toggleEmoji()">ğŸ˜Š</button>
    <input type="text" id="msgInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." onkeypress="if(event.key==='Enter') sendMsg()">
    <button onclick="sendMsg()" class="action-btn">â¤</button>
    
    <div id="emojiPicker" class="emoji-picker"></div>
</div>

<div id="sidePanel" class="side-panel">
    <div style="padding:20px; border-bottom:1px solid #333;">Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† Ø§Ù„Ø¢Ù†</div>
    <div id="userList"></div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAlim9FOvDcMqTJWINoBCHk3k6DNXS-jTo",
        authDomain: "zeweil-chat.firebaseapp.com",
        databaseURL: "https://zeweil-chat-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "zeweil-chat",
        storageBucket: "zeweil-chat.appspot.com",
        messagingSenderId: "79843372176",
        appId: "1:79843372176:web:ea511efffae60c2a6cfc15",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let myName, myRoom, myId;
    let messageLimit = 10;

    // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
    const emojis = ["ğŸ˜€","ğŸ˜ƒ","ğŸ˜„","ğŸ˜","ğŸ˜†","ğŸ˜…","ğŸ˜‚","ğŸ¤£","ğŸ˜Š","ğŸ˜‡","ğŸ™‚","ğŸ™ƒ","ğŸ˜‰","ğŸ˜Œ","ğŸ˜","ğŸ¥°","ğŸ˜˜","ğŸ˜—","ğŸ˜™","ğŸ˜š","ğŸ˜‹","ğŸ˜›","ğŸ˜","ğŸ˜œ","ğŸ¤ª","ğŸ¤¨","ğŸ§","ğŸ¤“","ğŸ˜","ğŸ¤©","ğŸ¥³","ğŸ˜","ğŸ˜’","ğŸ˜","ğŸ˜”","ğŸ˜Ÿ","ğŸ˜•","ğŸ™","â˜¹ï¸","ğŸ˜£","ğŸ˜–","ğŸ˜«","ğŸ˜©","ğŸ¥º","ğŸ˜¢","ğŸ˜­","ğŸ˜¤","ğŸ˜ ","ğŸ˜¡","ğŸ¤¬","ğŸ¤¯","ğŸ˜³","ğŸ¥µ","ğŸ¥¶","ğŸ˜±","ğŸ˜¨","ğŸ˜°","ğŸ˜¥","ğŸ˜“","ğŸ¤—","ğŸ¤”","ğŸ¤­","ğŸ¤«","ğŸ¤¥","ğŸ˜¶","ğŸ˜","ğŸ˜‘","ğŸ˜¬","ğŸ™„","ğŸ˜¯","ğŸ˜¦","ğŸ˜§","ğŸ˜®","ğŸ˜²","ğŸ¥±","ğŸ˜´","ğŸ¤¤","ğŸ˜ª","ğŸ˜µ","ğŸ¤","ğŸ¥´","ğŸ¤¢","ğŸ¤®","ğŸ¤§","ğŸ˜·","ğŸ¤’","ğŸ¤•","ğŸ¤‘","ğŸ¤ ","ğŸ˜ˆ","ğŸ‘¿","ğŸ‘¹","ğŸ‘º","ğŸ¤¡","ğŸ’©","ğŸ‘»","ğŸ’€","â˜ ï¸","ğŸ‘½","ğŸ‘¾","ğŸ¤–","ğŸƒ","ğŸ˜º","ğŸ˜¸","ğŸ˜¹","ğŸ˜»","ğŸ˜¼","ğŸ˜½","ğŸ™€","ğŸ˜¿","ğŸ˜¾","â¤ï¸","ğŸ§¡","ğŸ’›","ğŸ’š","ğŸ’™","ğŸ’œ","ğŸ–¤","ğŸ¤","ğŸ¤","ğŸ’”","â£ï¸","ğŸ’•","ğŸ’","ğŸ’“","ğŸ’—","ğŸ’–","ğŸ’˜","ğŸ’","ğŸ’Ÿ","ğŸ’Œ","ğŸ’‹","ğŸ”¥","âœ¨","ğŸŒŸ","â­","âš¡","ğŸ’¥","â„ï¸","â˜€ï¸","â˜ï¸","ğŸŒˆ"];
    const picker = document.getElementById('emojiPicker');
    emojis.forEach(e => {
        let span = document.createElement('span');
        span.className = 'emoji-item';
        span.innerText = e;
        span.onclick = () => {
            document.getElementById('msgInput').value += e;
            toggleEmoji();
        };
        picker.appendChild(span);
    });

    async function startApp() {
        myName = document.getElementById('userNameInput').value.trim();
        myRoom = document.getElementById('roomCodeInput').value.trim();
        if(!myName || !myRoom) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        
        await firebase.auth().signInAnonymously();
        myId = firebase.auth().currentUser.uid;
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('room-display').innerText = "ØºØ±ÙØ©: " + myRoom;
        
        loadMessages();
    }

    function toggleEmoji() {
        const p = document.getElementById('emojiPicker');
        p.style.display = p.style.display === 'grid' ? 'none' : 'grid';
    }

    function sendMsg() {
        const input = document.getElementById('msgInput');
        if(!input.value.trim()) return;
        db.ref(`rooms/${myRoom}/messages`).push({
            userId: myId, name: myName, message: input.value, timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        input.value = "";
    }

    function loadMessages() {
        const container = document.getElementById('chat-container');
        // Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø¨Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
        const oldMsgs = container.querySelectorAll('.msg');
        oldMsgs.forEach(m => m.remove());

        db.ref(`rooms/${myRoom}/messages`).limitToLast(messageLimit).on('value', (snap) => {
            const currentMsgs = container.querySelectorAll('.msg');
            currentMsgs.forEach(m => m.remove());
            
            snap.forEach(child => {
                const data = child.val();
                const div = document.createElement('div');
                div.className = `msg ${data.userId === myId ? 'sent' : 'received'}`;
                div.innerHTML = `<small style="display:block; font-size:10px;">${data.name}</small>${data.message}`;
                container.appendChild(div);
            });
            container.scrollTop = container.scrollHeight;
        });
    }

    function loadMoreMessages() {
        messageLimit += 10;
        loadMessages();
    }

    function togglePanel() { document.getElementById('sidePanel').classList.toggle('active'); }
</script>
</body>
</html>
